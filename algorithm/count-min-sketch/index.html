<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link type="text/css" rel="stylesheet" href="css/rickshaw.css">
  <script src="js/d3.min.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/rickshaw.min.js"></script>
  <script src="js/plot.js"></script>
  <script src="js/seedrandom.js"></script>
  <script src="js/murmurhash3_gc.js"></script>
  <script src="js/cmsketch.js"></script>
</script>
</head>
<body>
<h1>Count-Min Sketch</h1>

<h2>Overview</h2>
A count-min sketch can be used to produce a function, f&apos;<sub>(x)</sub>, that produces an estimate of an observed function f<sub>(x)</sub> such that the following holds true:

  f<sub>(x)</sub> &lt;= f&apos;<sub>(x)</sub> (estimate)
  f&apos;<sub>(x)</sub> &lt;= f<sub>(x)</sub> + &#949;*volume

To create a count-min sketch you have to choose a few parameters which control the characteristics of the estimate.

  &#948; (delta): [0,1] error occurs with probability (1.0 - delta)
  &#949; (epsilon): [0,1] error range.

The space requirement for storing a count-min sketch is O((e/&949;)ln(1/&948;)).
The runtime requirement for creating an estimate from a count-min sketch is O(ln(1/&948;)/&949;).

<h2>Implementation Notes</h2>

<b>Storage</b>
To translate a given &949; and &948; into width and depth use the equations below. For a configuration like &949; = 0.0001 and &949; = 0.995 you should get an array that&apos;s wider than it is deep.

  w = e/&949;
  d = ln(1/&948;)

EXAMPLE

<b>Universal Hashing vs. Pair-wise Independent Hashing</b>
This algorithm only depends on (AKAIK) universal hashing, and doesn't strictly rely on using pair-wise independent hashes. Many papers and examples that illustrate using two random numbers to create a hash functions of the form <b>h&apos;<sub>(x)</sub> = a * h<sub>(x)</sub> + b</b> are using pair-wise independent hashes. It is possible to instead rely on universal hashing and substitute an <b>h&apos;<sub>(x)</sub> = a * h<sub>(x)</sub></b> that generates just one random variable. (A pair-wise indepdent hash is basically common way to produce a universal hash, it also works but is not strictly neccessary).


<b>Saturation</b>
The amount error is proportional to cardinality, but it also proportional to the volume of data passed through the filter (volume is a factor of f'<sub>(x)</sub> above). To avoid excessive error from too much data being collected, typically, you'll using a sliding window technique to replace old data-filled filters with new ones and look at a series of small filters over time to make estimates [2].

EXAMPLE

<script>

var N = 100000;
var actual = [];
for (var i = 0; i < N; i++) {
  actual.push(Math.ceil(Math.random()*N));
}


function addGraph(accuracy, confidence) {
 
  var sketch0 = new CMSketch(accuracy, confidence);
  for (var i = 0; i < actual.length; i++) {
    sketch0.update(i, actual[i]);
  }
  var estimate = [];
  var errors = [];
  for (var i = 0; i < actual.length; i++) {
    var data = {x: actual[i], y: sketch0.lookup(i)};
    if(((accuracy*N) + data.x) < data.y) {
      errors.push(data);
    } else { 
      estimate.push(data);
    }
  }
  var sort = function(a,b) {
    if (a.x == b.x) { return 0; }
    return a.x > b.x ? 1 : -1;
  };
  estimate.sort(sort);
  errors.sort(sort);

  // Generate an element with the graph contents
  $('body').append('Accurracy: +-' + N*sketch0.accuracy() + ' per error<br/>');
  $('body').append('Confidence: ' + 100*sketch0.confidence() + '%<br/>');
  $('body').append('Space: ' + sketch0.space() + ' bytes<br/>');
  $('body').append('Cardinality: ' + N + ' counts<br/>');
  $('body').append('Error: ' + 100*(errors.length/actual.length) + '%<br/>');
  $('body').append( 
    plot({
      width: 1200,
      height: 350,
      renderer: 'scatterplot',
      series: [{
        name: 'Estimate',
  	    color: '#6699CC',
      	data: estimate,
      }, {
        name: 'Error',
  	    color: '#9999CC',
      	data: errors,
      }]
    })
  );
  
}

addGraph(0.00001, 0.999);

</script>
</div>

<div id='graph'>
</div>

</body>
</html>
