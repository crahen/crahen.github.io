<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link type="text/css" rel="stylesheet" href="css/rickshaw.css">
  <script src="js/d3.min.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/rickshaw.min.js"></script>
  <script src="js/plot.js"></script>
  <script src="js/seedrandom.js"></script>
  <script src="js/murmurhash3_gc.js"></script>
  <script src="js/cmsketch.js"></script>
</script>
</head>
<body>
<script>

var N = 1000;
var actual = [];
for (var i = 0; i < N; i++) {
  var r = 2*(i+1)
  actual.push({x: r, y: r});
}


function addGraph(accuracy, confidence) {
  
  var sketch0 = new CMSketch(accuracy, confidence);
  for (var i = 0; i < actual.length; i++) {
    sketch0.update(i, actual[i].y);
  }
  var estimate = [];
  var errors = [];
  for (var i = 0; i < actual.length; i++) {
    var data = {y: sketch0.lookup(i), x: actual[i].y};
    if(((accuracy*N) + data.x) < data.y) {
      errors.push({x: data.x, y: data.y});
    } else { 
      estimate.push(data);
    }
  }
  console.log(100*(errors.length / actual.length) + '% error');
  estimate.sort(function(a,b) {
    return a.x > b.x ? 1 : -1;
  });
  errors.sort(function(a,b) {
    return a.x > b.x ? 1 : -1;
  });

  // Generate an element with the graph contents
  $('body').append('Accurracy: +-' + N*sketch0.accuracy() + ' per error<br/>');
  $('body').append('Confidence: ' + 100*sketch0.confidence() + '%<br/>');
  $('body').append('Space: ' + sketch0.space() + ' bytes<br/>');
  $('body').append('Cardinality: ' + N + ' counts<br/>');
  $('body').append( 
    plot({
      width: 1200,
      height: 350,
      renderer: 'scatterplot',
      series: [{
        name: 'Estimate',
  	    color: '#6699CC',
      	data: estimate,
      }, {
        name: 'Error',
  	    color: '#9999CC',
      	data: errors,
      }]
    })
  );
  
}

addGraph(0.25, 0.85);
addGraph(0.00001, 0.99);

</script>
</div>

<div id='graph'>
</div>

</body>
</html>
